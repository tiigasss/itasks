<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tipos de Tarefa</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>üè∑Ô∏è Tipos de Tarefa</h1>
            <button class="logout-btn" onclick="window.location.href='kanban.html'">‚Üê Voltar</button>
        </header>

        <div class="form-container">
            <form id="addTypeForm" class="task-form">
                <div class="form-group">
                    <label>Novo Tipo</label>
                    <input type="text" name="name" required placeholder="Ex: Urgente">
                </div>
                <button type="submit" class="btn-primary">Adicionar</button>
            </form>

            <div style="margin-top: 2rem;">
                <div id="typesList"></div>
            </div>
        </div>
    </div>

    <script>
        const API = 'http://localhost:5000/api';

        async function loadTypes() {
            const res = await fetch(`${API}/task-types`);
            const types = await res.json();
            const list = document.getElementById('typesList');
            list.innerHTML = '';
            types.forEach(t => {
                list.innerHTML += `
                    <div class="task-card" style="display:flex; justify-content:space-between;">
                        <span>${t.name}</span>
                        <button onclick="deleteType(${t.id})" style="color:red; border:none; background:none; cursor:pointer;">Remover</button>
                    </div>`;
            });
        }

        async function deleteType(id) {
            if(confirm('Apagar?')) {
                await fetch(`${API}/task-types/${id}`, { method: 'DELETE' });
                loadTypes();
            }
        }

        document.getElementById('addTypeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            await fetch(`${API}/task-types`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name: formData.get('name') })
            });
            e.target.reset();
            loadTypes();
        });

        const curr = JSON.parse(localStorage.getItem('currentUser'));
        if (curr.type !== 'Gestor') {
            alert('Acesso negado!');
            window.location.href = 'kanban.html';
        }

        loadTypes();
    </script>
</body>
</html>